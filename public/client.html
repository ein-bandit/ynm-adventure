<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>community client</title>
    <script src="components/jquery/dist/jquery.min.js"></script>
    <script>
        if (!!window.EventSource) {

        var eventCounter = 0;
        var votingTime = 10;
        function connect() {


            ///how to get unique id?


            var source = new EventSource("/events", {withCredentials: false});
            $('#connect').css('display', 'none');
            $('#wait').css('display', 'block');
            source.onmessage = function (event) {

                var data = JSON.parse(event.data);
                console.log(event);
                if (data.eventNr > eventCounter) {
                    if (event.type === 'open' || event.type === 'message') {
                        $('#wait').css('display', 'none');
                    }
                    if (data.votingEnabled === true) {
                        $('#answers').css('display', 'block');
                        eventCounter = data.eventNr;
                        startVoting(data.votingTime);

                    }
                }
            };
            source.onerror = function (err) {
                console.log(err);
                $.get('/disconnect');
            };
        }

        } else {
            alert("Sorry, your browser does not work with this app. (EventSource not available)");
        }
        function sendAnswer(answer) {
            $.post('answer', {data: answer});
            $('#answers').css('display', 'none');
            $('#wait').css('display', 'block');
        }
        function startVoting(time) {
            var counter = 0;
            var interval = setInterval(function() {
                counter++;
                if (counter == time) {
                    $('#wait').css('display', 'block');
                    $('#answers').css('display', 'none');
                    clearInterval(interval);
                }
            }, 1000);
        }
    </script>
</head>
<body>
<h1>i am the client</h1>

<button id="connect" onclick="connect()">connect</button>
<div id="answers" style="display:none">

    <button onclick="sendAnswer(0)">yes</button>
    <button onclick="sendAnswer(1)">no</button>
</div>
<p style="color:red; display:none" id="wait">please wait...</p>
</body>
</html>